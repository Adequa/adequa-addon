!function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n){let t=null,o=0;const r={};Adequa.API.runtime.onConnect.addListener(function(e){"leboncoin"===e.name&&(e.onMessage.addListener(function(n){!function(e,n){if("response"===e.what){const n=e.data,t=[];for(const o of n.ads.reverse())t.push(Adequa.db.adSources.exists("lbc_"+o.list_id).then(n=>{const c={_id:"lbc_"+o.list_id,...o};e.call_id&&(c.interest=r[e.call_id].interest.name),n||t.push(Adequa.db.adSources.put(c).catch(console.warn))}));Promise.all(t).then(()=>{e.call_id&&(r[e.call_id].callback(),r[e.call_id]=null)})}else"stayNotified"===e.what?(Adequa.actions.interests.checkInterest(e.url,n.sender.tab.id),Adequa.actions.tabs.notify("Vous êtes parés","C'est ici que vous verrez apparaitre les notifications !")):console.log(e)}(n,e)}),t||(t=e),e.onDisconnect.addListener(function(){t=null}))});Adequa.catalogs.leboncoin={category:"Immobilier",poll:function(e,n){const c=e.request;c&&(r[o+=1]={callback:n||function(){},interest:e},t.postMessage({what:"query",call_id:o,body:c}))},generateAds:function(e,n){Adequa.db.adSources.query(function(e,n){!e.already_transformed&&e._id.startsWith("lbc_")&&n(e.index_date)},{include_docs:!0,limit:e}).then(function(e){const t=[];for(const{doc:n}of e.rows)t.push(Adequa.db.ads.post({title:n.subject,image:n.images.thumb_url,text:n.category_name+"\n"+n.location.city_label,link:n.url,price:((n.price||[]).length?n.price[0]:n.price||0)+"€",generated_at:Date.now(),interest:n.interest})),t.push(Adequa.db.adSources.put({_id:n._id,_rev:n._rev,already_transformed:!0}));Promise.all(t).then(n)}).catch(console.warn)},parseQuery:function(e){const n=Adequa.storage.leboncoinQueries[e.category];n.query_parameters=Object.assign({},Adequa.storage.leboncoinQueries.common.query_parameters,n.query_parameters);const t={parameters:{}};if(n){const o=n.query_parameters;for(const n in e){const r=e[n],c=o[n];c&&(t.parameters[c.name]=(c.keys||{})[r]||r)}}return t}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL2FjdGlvbnMvaW50ZXJlc3RzL2NhdGFsb2dzL2xlYm9uY29pbi5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImxiY1BvcnQiLCJjYWxsX2lkIiwicmVxdWVzdEJ1ZmZlciIsIkFkZXF1YSIsIkFQSSIsInJ1bnRpbWUiLCJvbkNvbm5lY3QiLCJhZGRMaXN0ZW5lciIsInBvcnQiLCJvbk1lc3NhZ2UiLCJtc2ciLCJ3aGF0IiwiZGF0YSIsInByb21pc2VzIiwiYWQiLCJhZHMiLCJyZXZlcnNlIiwicHVzaCIsImRiIiwiYWRTb3VyY2VzIiwiZXhpc3RzIiwibGlzdF9pZCIsInRoZW4iLCJleGlzdCIsIl9pZCIsImludGVyZXN0IiwicHV0IiwiY2F0Y2giLCJjb25zb2xlIiwid2FybiIsIlByb21pc2UiLCJhbGwiLCJjYWxsYmFjayIsImFjdGlvbnMiLCJpbnRlcmVzdHMiLCJjaGVja0ludGVyZXN0IiwidXJsIiwic2VuZGVyIiwidGFiIiwiaWQiLCJ0YWJzIiwibm90aWZ5IiwibG9nIiwiZXZlbnRIYW5kbGVyIiwib25EaXNjb25uZWN0IiwiY2F0YWxvZ3MiLCJjYXRlZ29yeSIsInBvbGwiLCJib2R5IiwicmVxdWVzdCIsInBvc3RNZXNzYWdlIiwiZ2VuZXJhdGVBZHMiLCJudW1iZXIiLCJxdWVyeSIsImRvYyIsImVtaXQiLCJhbHJlYWR5X3RyYW5zZm9ybWVkIiwic3RhcnRzV2l0aCIsImluZGV4X2RhdGUiLCJpbmNsdWRlX2RvY3MiLCJsaW1pdCIsInJvd3MiLCJwb3N0IiwidGl0bGUiLCJzdWJqZWN0IiwiaW1hZ2UiLCJpbWFnZXMiLCJ0aHVtYl91cmwiLCJ0ZXh0IiwiY2F0ZWdvcnlfbmFtZSIsImxvY2F0aW9uIiwiY2l0eV9sYWJlbCIsImxpbmsiLCJwcmljZSIsImxlbmd0aCIsImdlbmVyYXRlZF9hdCIsIkRhdGUiLCJub3ciLCJfcmV2IiwicGFyc2VRdWVyeSIsImxiY19lbnRyeSIsInN0b3JhZ2UiLCJsZWJvbmNvaW5RdWVyaWVzIiwicXVlcnlfcGFyYW1ldGVycyIsImFzc2lnbiIsImNvbW1vbiIsIm91dHB1dCIsInBhcmFtZXRlcnMiLCJsYmNRdWVyeVBhcmFtZXRlcnMiLCJpbmRleCIsInBhcmFtIiwibGJjUGFyYW0iLCJrZXlzIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxl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ImxlYm9uY29pbi5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJsZXQgbGJjUG9ydCA9IG51bGw7XHJcbmxldCBjYWxsX2lkID0gMDtcclxuY29uc3QgcmVxdWVzdEJ1ZmZlciA9IHt9O1xyXG5cclxuY29uc3QgZXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKG1zZywgcG9ydCkge1xyXG4gICAgaWYgKG1zZy53aGF0ID09PSBcInJlc3BvbnNlXCIpIHtcclxuICAgICAgICBjb25zdCBkYXRhID0gbXNnLmRhdGE7XHJcblxyXG4gICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XHJcbiAgICAgICAgZm9yIChjb25zdCBhZCBvZiBkYXRhLmFkcy5yZXZlcnNlKCkpIHtcclxuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChcclxuICAgICAgICAgICAgICAgIEFkZXF1YS5kYi5hZFNvdXJjZXMuZXhpc3RzKFwibGJjX1wiICsgYWQubGlzdF9pZCkudGhlbihleGlzdCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHtfaWQ6IFwibGJjX1wiICsgYWQubGlzdF9pZCwgLi4uYWR9O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtc2cuY2FsbF9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmludGVyZXN0ID0gcmVxdWVzdEJ1ZmZlclttc2cuY2FsbF9pZF0uaW50ZXJlc3QubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0KSBwcm9taXNlcy5wdXNoKEFkZXF1YS5kYi5hZFNvdXJjZXMucHV0KGRhdGEpLmNhdGNoKGNvbnNvbGUud2FybikpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAobXNnLmNhbGxfaWQpIHtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3RCdWZmZXJbbXNnLmNhbGxfaWRdLmNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0QnVmZmVyW21zZy5jYWxsX2lkXSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfSBlbHNlIGlmIChtc2cud2hhdCA9PT0gXCJzdGF5Tm90aWZpZWRcIikge1xyXG4gICAgICAgIEFkZXF1YS5hY3Rpb25zLmludGVyZXN0cy5jaGVja0ludGVyZXN0KG1zZy51cmwsIHBvcnQuc2VuZGVyLnRhYi5pZCk7XHJcbiAgICAgICAgQWRlcXVhLmFjdGlvbnMudGFicy5ub3RpZnkoJ1ZvdXMgw6p0ZXMgcGFyw6lzJywgJ0NcXCdlc3QgaWNpIHF1ZSB2b3VzIHZlcnJleiBhcHBhcmFpdHJlIGxlcyBub3RpZmljYXRpb25zICEnKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhtc2cpXHJcbiAgICB9XHJcbn07XHJcblxyXG5BZGVxdWEuQVBJLnJ1bnRpbWUub25Db25uZWN0LmFkZExpc3RlbmVyKGZ1bmN0aW9uIChwb3J0KSB7XHJcbiAgICBpZiAocG9ydC5uYW1lID09PSBcImxlYm9uY29pblwiKSB7XHJcbiAgICAgICAgcG9ydC5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgICAgICBldmVudEhhbmRsZXIobXNnLCBwb3J0KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKCFsYmNQb3J0KSBsYmNQb3J0ID0gcG9ydDtcclxuXHJcbiAgICAgICAgcG9ydC5vbkRpc2Nvbm5lY3QuYWRkTGlzdGVuZXIoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBsYmNQb3J0ID0gbnVsbDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG5cclxuY29uc3QgcG9sbCA9IGZ1bmN0aW9uIChpbnRlcmVzdCwgY2FsbGJhY2spIHtcclxuICAgIGNvbnN0IGJvZHkgPSBpbnRlcmVzdC5yZXF1ZXN0O1xyXG4gICAgaWYgKCFib2R5KSByZXR1cm47XHJcblxyXG4gICAgY2FsbF9pZCA9IGNhbGxfaWQgKyAxO1xyXG4gICAgcmVxdWVzdEJ1ZmZlcltjYWxsX2lkXSA9IHtcclxuICAgICAgICBjYWxsYmFjazogY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaW50ZXJlc3RcclxuICAgIH07XHJcblxyXG4gICAgbGJjUG9ydC5wb3N0TWVzc2FnZSh7d2hhdDogXCJxdWVyeVwiLCBjYWxsX2lkLCBib2R5fSk7XHJcbn07XHJcblxyXG5jb25zdCBnZW5lcmF0ZUFkcyA9IGZ1bmN0aW9uIChudW1iZXIsIGNhbGxiYWNrKSB7XHJcbiAgICBBZGVxdWEuZGIuYWRTb3VyY2VzLnF1ZXJ5KGZ1bmN0aW9uIChkb2MsIGVtaXQpIHtcclxuICAgICAgICBpZiAoIWRvYy5hbHJlYWR5X3RyYW5zZm9ybWVkICYmIGRvYy5faWQuc3RhcnRzV2l0aChcImxiY19cIikpXHJcbiAgICAgICAgICAgIGVtaXQoZG9jLmluZGV4X2RhdGUpO1xyXG4gICAgfSwge2luY2x1ZGVfZG9jczogdHJ1ZSwgbGltaXQ6IG51bWJlcn0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdO1xyXG4gICAgICAgIGZvciAoY29uc3Qge2RvY30gb2YgZGF0YS5yb3dzKSB7XHJcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2goQWRlcXVhLmRiLmFkcy5wb3N0KHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiBkb2Muc3ViamVjdCxcclxuICAgICAgICAgICAgICAgIGltYWdlOiBkb2MuaW1hZ2VzLnRodW1iX3VybCxcclxuICAgICAgICAgICAgICAgIHRleHQ6IGRvYy5jYXRlZ29yeV9uYW1lICsgXCJcXG5cIiArIGRvYy5sb2NhdGlvbi5jaXR5X2xhYmVsLFxyXG4gICAgICAgICAgICAgICAgbGluazogZG9jLnVybCxcclxuICAgICAgICAgICAgICAgIHByaWNlOiAoKGRvYy5wcmljZSB8fCBbXSkubGVuZ3RoID8gZG9jLnByaWNlWzBdIDogZG9jLnByaWNlIHx8IDApICsgXCLigqxcIixcclxuICAgICAgICAgICAgICAgIGdlbmVyYXRlZF9hdDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgICAgICAgIGludGVyZXN0OiBkb2MuaW50ZXJlc3RcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKEFkZXF1YS5kYi5hZFNvdXJjZXMucHV0KHtcclxuICAgICAgICAgICAgICAgIF9pZDogZG9jLl9pZCxcclxuICAgICAgICAgICAgICAgIF9yZXY6IGRvYy5fcmV2LFxyXG4gICAgICAgICAgICAgICAgYWxyZWFkeV90cmFuc2Zvcm1lZDogdHJ1ZVxyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGNhbGxiYWNrKVxyXG4gICAgfSkuY2F0Y2goY29uc29sZS53YXJuKTtcclxufTtcclxuXHJcbmNvbnN0IHBhcnNlUXVlcnkgPSBmdW5jdGlvbiAocXVlcnkpIHtcclxuICAgIGNvbnN0IGxiY19lbnRyeSA9IEFkZXF1YS5zdG9yYWdlLmxlYm9uY29pblF1ZXJpZXNbcXVlcnkuY2F0ZWdvcnldO1xyXG4gICAgbGJjX2VudHJ5LnF1ZXJ5X3BhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKHt9LCBBZGVxdWEuc3RvcmFnZS5sZWJvbmNvaW5RdWVyaWVzLmNvbW1vbi5xdWVyeV9wYXJhbWV0ZXJzLCBsYmNfZW50cnkucXVlcnlfcGFyYW1ldGVycyk7XHJcblxyXG4gICAgY29uc3Qgb3V0cHV0ID0ge3BhcmFtZXRlcnM6IHt9fTtcclxuXHJcbiAgICBpZiAobGJjX2VudHJ5KSB7XHJcbiAgICAgICAgLy8gb3V0cHV0Lm5hbWUgPSBsYmNfZW50cnkubmFtZTtcclxuXHJcbiAgICAgICAgY29uc3QgbGJjUXVlcnlQYXJhbWV0ZXJzID0gbGJjX2VudHJ5LnF1ZXJ5X3BhcmFtZXRlcnM7XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgaW5kZXggaW4gcXVlcnkpIHtcclxuICAgICAgICAgICAgY29uc3QgcGFyYW0gPSBxdWVyeVtpbmRleF07XHJcbiAgICAgICAgICAgIGNvbnN0IGxiY1BhcmFtID0gbGJjUXVlcnlQYXJhbWV0ZXJzW2luZGV4XTtcclxuXHJcbiAgICAgICAgICAgIGlmIChsYmNQYXJhbSkge1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0LnBhcmFtZXRlcnNbbGJjUGFyYW0ubmFtZV0gPSAobGJjUGFyYW0ua2V5cyB8fCB7fSlbcGFyYW1dIHx8IHBhcmFtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvdXRwdXQ7XHJcbn07XHJcblxyXG5jb25zdCByZW5kZXJRdWVyeSA9IGZ1bmN0aW9uIChpbnRlcmVzdCkge1xyXG4gICAgY29uc3QgbGJjX2VudHJ5ID0gQWRlcXVhLnN0b3JhZ2UubGVib25jb2luUmV2ZXJzZWRRdWVyaWVzW2ludGVyZXN0Lm5hbWVdO1xyXG4gICAgY29uc3Qgb3V0cHV0ID0ge3BhcmFtZXRlcnM6IHt9fTtcclxuXHJcbiAgICBpZiAobGJjX2VudHJ5KSB7XHJcbiAgICAgICAgb3V0cHV0Lm5hbWUgPSBsYmNfZW50cnkubmFtZTtcclxuXHJcbiAgICAgICAgY29uc3QgbGJjUXVlcnlQYXJhbWV0ZXJzID0gbGJjX2VudHJ5LnF1ZXJ5X3BhcmFtZXRlcnM7XHJcbiAgICAgICAgZm9yIChjb25zdCBpbmRleCBpbiBpbnRlcmVzdC5wYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGxiY1BhcmFtID0gbGJjUXVlcnlQYXJhbWV0ZXJzW2luZGV4XTtcclxuICAgICAgICAgICAgY29uc3QgcGFyYW0gPSBpbnRlcmVzdC5wYXJhbWV0ZXJzW2luZGV4XTtcclxuICAgICAgICAgICAgaWYgKGxiY1BhcmFtKSB7XHJcbiAgICAgICAgICAgICAgICBvdXRwdXQucGFyYW1ldGVyc1tsYmNQYXJhbS5uYW1lXSA9IGxiY1BhcmFtLmtleXNbcGFyYW1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBvdXRwdXQ7XHJcbn07XHJcblxyXG5BZGVxdWEuY2F0YWxvZ3NbXCJsZWJvbmNvaW5cIl0gPSB7XHJcbiAgICBjYXRlZ29yeTogXCJJbW1vYmlsaWVyXCIsXHJcbiAgICBwb2xsLFxyXG4gICAgZ2VuZXJhdGVBZHMsXHJcbiAgICBwYXJzZVF1ZXJ5XHJcbn07XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=